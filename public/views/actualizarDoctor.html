<html>

<head>
    <title>Hanzoft - Modificar Doctor</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <h1>Modificar Doctor</h1>

    <form id="ModificarDoctor">
        <label for="nombre"> nombre del Doctor:</label>
        <input type="text" id="nombre" name="nombre" maxlength="30">
        <br>
        <br>
        <label><strong>Especialidad</strong></label>
        <select id="especialidad" name="especialidad" required>
            <!-- Cada opci√≥n tiene un n√∫mero como "value" que representa el ID de la especialidad en la base de datos -->
            <option value="1">Medicina Interna</option>
            <option value="2">Cardiolog√≠a</option>
            <option value="3">Oftalmolog√≠a</option>
            <option value="4">Cirug√≠a</option>
            <option value="5">Radiolog√≠a</option>
        </select>
        <br>
        <!-- Bot√≥n que env√≠a el formulario -->
        <!-- El div es como el contenedor -->
        <div>
            <br>
            <button type="submit"> üíæ Guardar Cambios </button>
        </div>
    </form>

    <!-- Aqu√≠ empieza el c√≥digo JavaScript -->
    <script>
        //Aca estoy creando con el nombre parametros Get un objeto URLSearchParams para leer los par√°metros que vienen en la URL,
        // o sea en este caso mi ID
        const parametrosGet = new URLSearchParams(window.location.search);

        // Aca obtenemos el ID, para poder pasarlo 
        const id = parametrosGet.get('id');

        // Definimos la URL donde vamos a enviar los datos usando el m√©todo PUT
        const ruta = `http://localhost:3000/api/doctores/${id}`;

        // Seleccionamos el formulario usando su ID (formulario-doctor)
        const formulario = document.querySelector('#ModificarDoctor');
        const nombreInput = formulario.querySelector('#nombre')
        const especialidadSelector = formulario.querySelector('#especialidad')
        
        axios.get(ruta)
            .then(function (respuesta) {
                const doctor = respuesta.data;            
                nombreInput.value = doctor.nombre;
                especialidadSelector.value = doctor.especialidades_id
            });
    
        // Escuchamos el evento "submit", o sea, cuando el usuario hace clic en "Crear"
        formulario.addEventListener('submit', function (event) {
            console.log(event)
            // Esto evita que el formulario recargue la p√°gina al enviarse
            event.preventDefault();
            
            // Enviamos una solicitud PUT a la API, con los datos del formulario
            axios.put(ruta, {
                // nombre del doctor
                nombre: nombreInput.value,
                // id de la especialidad seleccionada
                especialidad: especialidadSelector.value
            })
            // Si el doctor se actualizo correctamente, mostramos un mensaje
            .then(function (respuesta) {
                alert(respuesta.data.mensaje);
                // Tambi√©n lo mostramos en consola
                console.log(respuesta.data.mensaje);
                window.location.href = 'http://localhost:3000/app/doctores.html'

            })
            // Si hubo un error en la petici√≥n, mostramos un mensaje de error
            .catch(function (error) {
                alert(error.response.data.error);
                console.error(error);
            });
        });
    </script>
</body>
</html>